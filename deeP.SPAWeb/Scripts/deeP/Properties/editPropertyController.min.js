(function(){"use strict";angular.module("deePProperties").controller("editPropertyController",["$scope","$uibModalInstance","$timeout","uiGmapGoogleMapApi","uuid2","FileUploader","accountContext","propertyServiceUrl","propertyService","property",function(n,t,i,r,u,f,e,o,s,h){var c=this,l;c.newProperty=!h||!h.id;c.property=h?_.cloneDeep(h):{type:0,bedrooms:0,imageInfos:[]};c.property.id||(c.property.id=u.newguid());c.property.locationDetails=c.property.locationDetails||{};c.ok=function(){c.newProperty?s.addProperty(c.property).then(function(){t.close({property:c.property})},function(n){c.error=n}):s.editProperty(c.property).then(function(){t.close({property:c.property})},function(n){c.error=n})};c.cancel=function(){t.dismiss()};l={control:{},center:{latitude:48.5490951,longitude:11.8266606},zoom:5,options:{maxZoom:16},markers:[],fit:c.property.locationDetails.zoom<=3&&c.property.locationDetails.markers&&c.property.locationDetails.markers.length>0,events:{idle:function(){l.fit=!1}}};angular.extend(l,c.property.locationDetails);c.map=l;c.showMap=!1;r.then(function(n){i(function(){var t={places_changed:function(t){var u=t.getPlaces(),f,r,i,e,o;if(u.length===0){c.map.markers=[];c.property.address="";return}for(f=[],r=0;!!(i=u[r]);r++)e={url:i.icon,size:new n.Size(71,71),origin:new n.Point(0,0),anchor:new n.Point(12,24),scaledSize:new n.Size(25,25)},o=new n.Marker({icon:e,title:i.name,position:i.geometry.location,latitude:i.geometry.location.lat(),longitude:i.geometry.location.lng(),addressComponents:i.address_components,id:r}),f.push(o);c.map.fit=!0;c.map.markers=_.take(f,5);c.property.address=u[0].formatted_address}};c.searchbox={template:"searchbox.tpl.html",events:t};i(function(){c.showMap=!0})})});c.uploader=new f({url:"/api/images/storeimage",method:"PUT",autoUpload:!0,headers:{Accept:"application/json",Authorization:"Bearer "+e.accessToken}});c.uploader.onCompleteItem=function(n,t,i){i===200&&c.property.imageInfos.push({id:t[0],title:t[0],uri:o+"api/images/"+t[0]})};c.dropImage=function(n){c.property.imageInfos.splice(n,1)};n.$watch(function(){return c.map},function(n){c.property.locationDetails.center=n.center;c.property.locationDetails.zoom=n.zoom;c.property.locationDetails.markers=n.markers},!0)}])})();
//# sourceMappingURL=editPropertyController.min.js.map
