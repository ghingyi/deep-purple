(function(){"use strict";angular.module("deePProperties").controller("editPropertyController",["$scope","$uibModalInstance","$timeout","uiGmapGoogleMapApi","uuid2","FileUploader","propertyServiceUrl","propertyService","property",function(n,t,i,r,u,f,e,o,s){var h=this,c;h.newProperty=!s||!s.id;h.property=s?_.cloneDeep(s):{type:0,bedrooms:0,imageInfos:[]};h.property.id||(h.property.id=u.newguid());h.property.locationDetails=h.property.locationDetails||{};h.ok=function(){h.newProperty?o.addProperty(h.property).then(function(){t.close({property:h.property})},function(n){h.error=n}):o.editProperty(h.property).then(function(){t.close({property:h.property})},function(n){h.error=n})};h.cancel=function(){t.dismiss()};c={control:{},center:{latitude:48.5490951,longitude:11.8266606},zoom:5,options:{maxZoom:16},markers:[],fit:h.property.locationDetails.zoom<=3&&h.property.locationDetails.markers&&h.property.locationDetails.markers.length>0,events:{idle:function(){c.fit=!1}}};angular.extend(c,h.property.locationDetails);h.map=c;h.showMap=!1;r.then(function(n){i(function(){var t={places_changed:function(t){var u=t.getPlaces(),f,r,i,e,o;if(u.length===0){h.map.markers=[];h.property.address="";return}for(f=[],r=0;!!(i=u[r]);r++)e={url:i.icon,size:new n.Size(71,71),origin:new n.Point(0,0),anchor:new n.Point(12,24),scaledSize:new n.Size(25,25)},o=new n.Marker({icon:e,title:i.name,position:i.geometry.location,latitude:i.geometry.location.lat(),longitude:i.geometry.location.lng(),addressComponents:i.address_components,id:r}),f.push(o);h.map.fit=!0;h.map.markers=_.take(f,5);h.property.address=u[0].formatted_address}};h.searchbox={template:"searchbox.tpl.html",events:t};i(function(){h.showMap=!0})})});h.uploader=new f({url:"/api/images/storeimage",method:"PUT",autoUpload:!0});h.uploader.onCompleteItem=function(n,t,i){i===200&&h.property.imageInfos.push({id:t[0],title:t[0],uri:e+"api/images/"+t[0]})};h.dropImage=function(n){h.property.imageInfos.splice(n,1)};n.$watch(function(){return h.map},function(n){h.property.locationDetails.center=n.center;h.property.locationDetails.zoom=n.zoom;h.property.locationDetails.markers=n.markers},!0)}])})();
//# sourceMappingURL=editPropertyController.min.js.map
